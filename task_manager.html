<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire de Tâches 2025</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        gray: { 50: '#F9FAFB', 100: '#F3F4F6', 200: '#E5E7EB', 800: '#1F2937', 900: '#111827' }
                    }
                }
            }
        }
    </script>

    <script src="https://unpkg.com/vue@3.4.0"></script>

    <style>
        .task-item { transition: all 0.2s ease-in-out; }
        .task-item:hover { transform: translateY(-1px); }

        /* Animation pour le dropdown */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.2s ease, transform 0.2s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; transform: translateY(-10px); }
    </style>
</head>

<body class="bg-gray-50 text-gray-800 antialiased min-h-screen flex items-center justify-center py-10">

<div id="app" class="w-full max-w-xl px-4">

    <header class="mb-8 text-center">
        <h1 class="text-3xl font-semibold text-gray-900 tracking-tight">Mes Tâches</h1>
        <p class="text-gray-500 mt-2 text-sm">Restez organisé, restez concentré.</p>
    </header>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-visible">

        <!-- Section Ajout -->
        <div class="p-6 border-b border-gray-100 bg-white rounded-t-2xl relative z-20">
            <form class="flex flex-col gap-4 sm:flex-row" @submit.prevent>
                <input
                        ref="newTaskInput"
                        class="flex-grow bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-xl focus:ring-2 focus:ring-gray-900 focus:border-gray-900 block w-full p-3 outline-none transition-all placeholder-gray-400"
                        placeholder="Inscrire une tâche"
                        v-model="task.name"
                >

                <div class="flex gap-2 relative">

                    <!-- CUSTOM DROPDOWN -->
                    <div class="relative w-40">
                        <!-- bouton déclencheur -->
                        <button
                                type="button"
                                @click="isOpen = !isOpen"
                                class="w-full bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-xl focus:ring-2 focus:ring-gray-900 block p-3 px-4 outline-none flex items-center justify-between transition-all hover:bg-gray-100"
                        >
                            <span class="truncate">{{ selectedPriority || 'Priorité' }}</span>
                            <!-- Icône Chevron qui tourne -->
                            <svg :class="{'rotate-180': isOpen}" class="w-4 h-4 text-gray-500 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>

                        <!-- Dropdown -->
                        <transition name="fade">
                            <div v-if="isOpen" class="absolute top-full mt-2 left-0 w-full bg-white border border-gray-100 rounded-xl shadow-xl z-50 overflow-hidden p-1">
                                <ul class="text-sm text-gray-700">
                                    <!-- Option Haute -->
                                    <li v-for="priority in priorities" :key="priority.id" @click="selectPriority(priority.id)" class="cursor-pointer px-3 py-2 hover:bg-gray-50 rounded-lg flex items-center gap-2 transition-colors">
                                        <span class="w-2 h-2 rounded-full" :class="priority.color"></span>
                                        {{ priority.label }}
                                    </li>
                                </ul>
                            </div>
                        </transition>
                    </div>

                    <button type="submit" @click="handleSubmit()" class="text-white bg-gray-900 hover:bg-gray-800 focus:ring-4 focus:ring-gray-300 font-medium rounded-xl text-sm px-6 py-3 transition-colors shadow-sm">
                        Ajouter
                    </button>
                </div>
            </form>
        </div>

        <!-- Section Filtre -->
        <div class="px-6 py-4 bg-gray-50 border-b border-gray-100 flex items-center gap-3 relative z-10">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <input
                    v-model="filterText"
                    class="bg-transparent border-none text-gray-600 text-sm w-full focus:ring-0 placeholder-gray-400"
                    placeholder="Rechercher une tâche..."
            >
        </div>

        <!-- Conteneur Liste -->
        <div class="p-6 bg-white min-h-[200px] z-0">
            <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Liste des tâches</h3>

            <div class="space-y-3">

                <div v-for="(task, index) in filteredTasks" :key="task.id" class="task-item group flex items-center justify-between p-4 bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-md hover:border-gray-200">

                    <div class="flex items-center gap-4">
                        <div class="relative flex items-center">
                            <input type="checkbox" class="peer h-5 w-5 cursor-pointer appearance-none rounded-md border border-gray-300 transition-all checked:border-gray-900 checked:bg-gray-900">
                            <svg class="pointer-events-none absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3.5 h-3.5 text-white opacity-0 peer-checked:opacity-100" viewBox="0 0 14 14" fill="none"><path d="M11.6666 3.5L5.24992 9.91667L2.33325 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </div>
                        <div v-if="!task.done" class="flex flex-col">
                            <span class="text-sm font-medium text-gray-700 group-hover:text-gray-900">{{ task.name }}</span>
                            <!-- Badge -->
                            <span :class="`${getTaskPriority(task.priority).txtColor} ${getTaskPriority(task.priority).borderColor} ${getTaskPriority(task.priority).backgroundColor}`" class="text-[10px] font-bold px-2.5 py-0.5 rounded-full w-fit mt-1 border">{{ task.priority }}</span>
                        </div>

                        <div v-else class="flex flex-col">
                            <span class="text-sm font-medium text-gray-400 line-through transition-colors">{{ task.name }}</span>
                            <span class="text-[10px] font-bold text-gray-400 bg-gray-100 px-2.5 py-0.5 rounded-full w-fit mt-1 border border-gray-200">Terminée</span>
                        </div>
                    </div>
                    <button @click="deleteTask(index)" class="remove-button text-gray-300 hover:text-red-500 transition-colors p-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>

            </div>
        </div>

    </div>
</div>

<script>
    const { createApp, computed, ref, onBeforeMount, onMounted, watch } = Vue;

    const App = {
        setup() {
            // J'ai ajouté ces variables uniquement pour gérer l'ouverture/fermeture visuelle du dropdown
            const isOpen = ref(false);
            const selectedPriority = ref('');
            const tasks = ref(JSON.parse(localStorage.getItem('tasks') ?? '[]'));
            const newTaskInput = ref(null);
            const filterText = ref('');
            const task = ref({
                id: tasks.value.length,
                name: '',
                priority: null,
                done: false
            });

            const filteredTasks = computed(
                () => tasks.value.filter(
                    task => task.name.toLowerCase()
                        .includes(filterText.value.toLowerCase())
                )
            );

            const TASK_PRIORITY = [
                { id: "low", label: "Basse", color: "bg-green-500", backgroundColor: "bg-green-50", borderColor: "border-green-100", txtColor: "text-green-700" },
                { id: "normal", label: "Normale", color: "bg-green-700", backgroundColor: "bg-emerald-50", borderColor: "border-emerald-100", txtColor: "text-emerald-700"  },
                { id: "high", label: "Haute", color: "bg-orange-500", backgroundColor: "bg-orange-50", borderColor: "border-orange-100", txtColor: "text-orange-700"  },
                { id: "urgent", label: "Urgente", color: "bg-red-500", backgroundColor: "bg-red-50", borderColor: "border-red-100", txtColor: "text-red-700"  },
            ];

            const selectPriority = (val) => {
                task.value.priority = val;
                isOpen.value = false;
            };

            const handleSubmit = () => {
                if (task.value.name !== '' && task.value.priority !== null) {
                    tasks.value.unshift(task.value);
                }

                resetData();
            }

            const getTaskPriority = (taskPriority) => {
                const priority = TASK_PRIORITY.filter(p => p.id === taskPriority);

                if (priority[0] === undefined) return {};
                return priority[0];
            }

            const deleteTask = (index) => {
                tasks.value.splice(index, 1);
            }

            const resetData = () => {
              task.value = {
                  id: tasks.value.length + 1,
                  name: '',
                  priority: null,
                  done: false
              }
            };

            watch(tasks, () => {
                localStorage.setItem(
                    'tasks',
                    JSON.stringify(tasks.value)
                )
            }, { deep: true });

            onMounted(() => {
                newTaskInput.value.focus();
            });
            onBeforeMount(() => {
                console.log('before mounted');
            });

            return {
                task,
                filteredTasks,
                isOpen,
                selectedPriority,
                newTaskInput,
                filterText,
                priorities: TASK_PRIORITY,
                selectPriority,
                getTaskPriority,
                deleteTask,
                handleSubmit
            }
        },
    };

    createApp(App).mount('#app');
</script>
</body>
</html>
